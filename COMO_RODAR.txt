# COMO RODAR – Quartinho-PS

Este guia descreve como iniciar o backend (Django), o web (Vite/React) e o mobile (Flutter), além de notas de configuração de host e Google Maps.

## Pré-requisitos
- Windows com PowerShell
- Python 3.10+ e `pip`
- Node.js 18+ e `npm`
- Flutter SDK instalado (testado com Flutter 3.35.4)
- Opcional (para Flutter Desktop Windows): Visual Studio (Build Tools) com workload “Desktop development with C++”

---
## 1) Backend (Django)
1. `cd backend`
2. Crie e ative o ambiente:
   - `python -m venv .venv`
   - `.venv\Scripts\Activate.ps1`
3. Instale dependências:
   - `pip install -r requirements.txt`
4. Migrações e servidor:
   - `python manage.py migrate`
   - `python manage.py runserver`
5. Backend disponível em: `http://127.0.0.1:8000/`

Observações:
- Certifique-se de que `ALLOWED_HOSTS` e CORS estão configurados para aceitar `localhost`/`127.0.0.1` (especialmente para desenvolvimento web/mobile).

---
## 2) Web (Vite + React)
1. `cd web`
2. Instale e rode:
   - `npm install`
   - `npm run dev`
3. Acesse: `http://localhost:5174/` (se ocupado, Vite escolherá outro porto, ex.: 5175)

Configuração de API:
- A base de API é centralizada em `web/src/utils/apiConfig.ts` via `API_BASE_URL`.
- Use `http://127.0.0.1:8000` para evitar problemas de IPv6/localhost no Windows.
- Telas ajustadas para usar a base unificada:
  - `EmailLogin.tsx`: usa `${API_BASE_URL}/usuarios/login/`
  - `Register.tsx`: usa `${API_BASE_URL}/usuarios/usercreate/` e `${API_BASE_URL}/usuarios/check-email/`

---
## 3) Mobile (Flutter)
Preferência rápida para testar Web:
- `cd mobile`
- `flutter pub get`
- `flutter run -d edge` (abre no Microsoft Edge). Se quiser Chrome, use `-d chrome` quando disponível.

Para executar em Desktop (Windows):
- Instale Visual Studio com “Desktop development with C++”.
- Rode: `flutter run -d windows`.
- Se aparecer “Unable to find suitable Visual Studio toolchain”, instale/atualize os componentes C++.

Para Android (emulador):
- Inicie um AVD pelo Android Studio.
- Use: `flutter run -d emulator-5554` (ou o id do seu emulador).
- Como o backend está no host, a API deve usar `10.0.2.2` dentro do emulador.

Seleção de Host da API no Flutter:
- Arquivo: `mobile/lib/core/constants.dart`
- Já configurado:
  - Web/Windows/Linux/macOS: `http://127.0.0.1:8000`
  - Android emulador: `http://10.0.2.2:8000`
  - iOS/Android físico: use seu IP LAN (ex.: `http://192.168.x.x:8000`)
- Para forçar “modo emulador Android”, rode com `--dart-define=IS_EMULATOR=true`, por exemplo:
  - `flutter run -d emulator-5554 --dart-define=IS_EMULATOR=true`

Serviços que usam a base:
- `auth_service.dart`, `favorites_service.dart`, `messages_service.dart` usam `backendHost` para montar as URLs.

---
## 4) Google Maps – O que fazer para ficar funcional

### 4.1 Web (React)
- Crie um projeto no Google Cloud, habilite “Maps JavaScript API” e configure billing.
- Gere uma API Key restrita ao seu domínio/localhost.
- Instale o wrapper React:
  - `npm i @react-google-maps/api`
- Adicione a key no `.env` do `web`:
  - `VITE_GOOGLE_MAPS_API_KEY=YOUR_KEY_HERE`
- Exemplo simples de uso:
  ```tsx
  import { useMemo } from 'react';
  import { GoogleMap, Marker, useJsApiLoader } from '@react-google-maps/api';

  const center = { lat: -23.5505, lng: -46.6333 };

  export function MapWidget() {
    const { isLoaded } = useJsApiLoader({ id: 'gmaps', googleMapsApiKey: import.meta.env.VITE_GOOGLE_MAPS_API_KEY });
    const containerStyle = useMemo(() => ({ width: '100%', height: 350 }), []);
    if (!isLoaded) return null;
    return (
      <GoogleMap mapContainerStyle={containerStyle} center={center} zoom={12}>
        <Marker position={center} />
      </GoogleMap>
    );
  }
  ```

### 4.2 Mobile (Flutter)
- No `pubspec.yaml`:
  - `google_maps_flutter: ^2.7.0`
  - Para suporte Web, também: `google_maps_flutter_web: ^0.5.6`
- Rode `flutter pub get`.

Android:
- Em `android/app/src/main/AndroidManifest.xml`, dentro de `<application>`:
  ```xml
  <meta-data
      android:name="com.google.android.geo.API_KEY"
      android:value="YOUR_ANDROID_KEY" />
  ```
- Garanta que o `minSdkVersion` >= 21.

iOS:
- Em `ios/Runner/AppDelegate.swift` (Swift) ou `AppDelegate.m` (Obj-C), inicialize:
  ```swift
  import GoogleMaps
  GMSServices.provideAPIKey("YOUR_IOS_KEY")
  ```
- Adicione permissões em `Info.plist` conforme necessário.

Flutter Web:
- Adicione o script do Maps no `mobile/web/index.html` (projeto Flutter):
  ```html
  <script src="https://maps.googleapis.com/maps/api/js?key=YOUR_WEB_KEY"></script>
  ```
- Inclua `google_maps_flutter_web` no `pubspec.yaml`.

Uso básico em Flutter:
```dart
import 'package:google_maps_flutter/google_maps_flutter.dart';

class SimpleMap extends StatelessWidget {
  const SimpleMap({super.key});
  @override
  Widget build(BuildContext context) {
    const pos = LatLng(-23.5505, -46.6333);
    return GoogleMap(
      initialCameraPosition: const CameraPosition(target: pos, zoom: 12),
      markers: { const Marker(markerId: MarkerId('A'), position: pos) },
      myLocationEnabled: true,
    );
  }
}
```

Notas de segurança:
- Restrinja suas Keys no Google Cloud (domínios, SHA-1 do app, pacotes). Nunca exponha keys de produção em repositórios públicos.

---
## 5) Dicas de troubleshooting
- Se o web não conecta ao backend, verifique `API_BASE_URL` e se o backend está em `127.0.0.1:8000`.
- No mobile, confirme se o `backendHost` está correto para sua plataforma (emulador vs. físico vs. desktop).
- Erro de Flutter Desktop (Windows) sobre Visual Studio: instale o workload C++ Desktop e reinicie.
- CORS/CSRF no Django: habilite para `http://localhost:5174` e `http://127.0.0.1:8000` em desenvolvimento.